<!DOCTYPE html>
<html>
<head>
<title>My Snake</title>
<style>
html, body {
height: 100%;
margin: 0;
}
body {
background: black;
display: flex;
align-items: center;
justify-content: center;
}
canvas {
boder: 1px solid white;
}
</style>	
</head>
<body>
<canvas width="400" height="400" id="game"></canvas>
<script>
//Tạo bộ khung chứa game
var canvas = document.getElemenById('game');
var context = canvas.getContext('2d');
var grid = 16;
//Tạo đối tượng rắn là 1 ô vuông
var snake={
x: 160, //Vị trí của rắn theo hướng x,y
y: 160,
dx: grid, //Hướng di chuyển theo phương x hoặc y, ở đây khi start game
//Rắn sẽ di chuyển theo x direction với value=16
dy:0,
cells:[],
maxCells:4
};
var count=0;
var apple={
x:320,
y=320
};
function getRandomInt(min,max){
return Math.floor(Math.random()*(max-min))+min;
}
//Game loop
function loop(){
//Hàm này giống setTimeout, sẽ gọi lại hàm loop khi loop thực thi xong
requestAnimationFrame(loop);
//Slow game loop to 15 fps instead of 60-60/15=4
if(++count<4){
return;
}
count=0;
context.clearRect(0,0,canvas.width,canvas.height);
snake.x+=snake.dx; //Mỗi loop rắn sexdi chuyển thêm 1dx đơn vị
snake.y+=snake.dy;
//Khi rắn đụng tường sẽ chạy lại từ edge đối diện
if(snake.x<0){
snake.x=canvas.width-grid;
}
else if(snake.x>=canvas.width){
snake.x=0;
}
if(snake.y<0){
snake.y=canvas.height-grid;
}
else if(snake.y>=canvas.height){
snake.y=0;
}
//Phương thức unshift sẽ thêm 1 hoặc nhiều phần tử vào đầu mảng
snake.cells.unshift({x:snake.x, y:snake.y});
//Thêm 1 ô vuông phía trước thì phải remove 1 cái phía sau để rắn di chuyển được
if(snake.cells.length>snake.maxCells){
snake.cells.pop();
}
//Vẽ apple
context.fillStyle='red';
context.fillRect(apple.x, apple.y, grid-1, grid-1);
//Vẽ rắn
context.fillStyle='green';
snake.cells.forEach(function(cell, index)){
context.fillRect(cell.x,cell.y,grid-1,grid-1);
//Rắn ăn apple
if(cell.x===apple.x && cell.y===apple.y){
snake.maxCells++;
apple.x=getRandomInt(0,25)*grid;
apple.y=getRandomInt(0,25)*grid;
}
//Check va chạm khi rắn đụng đuôi
for(var i = index+1; i<snake.cells.length;i++){
//Va chạm thì reset game
if(cell.x===snake.cells[i].x && cell.y === snake.cells[i].y){
snake.x=160;
snake.y=160;
snake.cells=[];
snake.maxCells=4;
snake.dx=grid;
snake.dy=0;
apple.x=getRandomInt(0,25)*grid;
apple.y=getRandomInt(0,25)*grid;
}
}
});
}
//Sự kiện bàn phím ấn xuống
document.addEventListener('keydown', function(e){
//Lọc sự kiện keydown để rắn không đi ngược lại
if(e.which===37 && snake.dy===0){
snake.dx=-grid;
snake.dy=0;
}
else if(e.which===38 && snake.dy===0){
snake.dy=-grid;
snake.dx=0;
}
else if(e.which===39 && snake.dy===0){
snake.dy=-grid;
snake.dx=0;
}
else if(e.which===40 && snake.dy===0){
snake.dy=-grid;
snake.dx=0;
}
});
requestAnimationFrame(loop);
</script>
</body>
</html>